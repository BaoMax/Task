<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>A*寻路</title>
	<style type="text/css">
		#board{
			border:1px solid #000;
			width: 400px;
			height: 400px;
			display: inline-block;
		}
		#board span{
			display: inline-block;
			width: 40px;
			font-size: 24px;
			text-align: center;
			height: 40px;
			line-height: 40px;
			box-sizing:border-box;
			border:1px solid #dedede;
			float: left;
		}
		#board .wall{
			background-color: blue;
		}
	</style>
</head>
<body>
	<div id="board"></div>
	<button id="btn">开始</button>
	<script type="text/javascript">
		var board = document.getElementById("board");
		var boardList = [];
		var rows = 10;
		var colums = 10;
		var start = new point(2,1);
		var end = new point(2,5);

		Array.prototype.getMin = function(){
			if(this.length == 1){
				return 0;
			}
			var flg = 0;
			var min = this[flg];
			for(var i = 1;i<this.length;i++){
				if(this[i].F < this[flg].F){
					flg = i;
				}
			}
			return flg;
		}
		Array.prototype.isIn = function(node){
			for(var i = 0;i<this.length;i++){
				if(this[i].node.x == node.node.x && this[i].node.y == node.node.y){
					return true;
				}
			}
			return false;
		}
		Array.prototype.getNode = function(node){
			for(var i = 0;i<this.length;i++){
				if(this[i].node.x == node.node.x && this[i].node.y == node.node.y){
					return i;
				}
			}
		}
		function point(x,y){
			this.x = x;
			this.y = y;
		}
		point.prototype.isEqual = function(p){
			return this.x == p.x && this.y == p.y;
		}
		function getPath(start,end){
			var openList = [];
			var closedList = [];
			var result = [];
			openList.push(new Node(start,null,0));
			while(openList[openList.getMin()].H){
				var pos = openList.getMin();
				var node = openList.splice(pos,1)[0]; 
				closedList.push(node);
				var G = node.G;
				if(node.node.x > 0){
					if(boardList[node.node.x-1][node.node.y]!=1){
						var topNode = new Node(new point(node.node.x-1,node.node.y),node,G+10);
						if(!closedList.isIn(topNode)){
							if(openList.isIn(topNode)){
								var testPos = openList.getNode(topNode);
								if(openList[testPos].G > topNode.G){
									openList[testPos].p = node;
								}
							}else{
								openList.push(topNode);
							}
						}
					}
				}
				if(node.node.x < 9){
					if(boardList[node.node.x+1][node.node.y]!=1){
						var botNode = new Node(new point(node.node.x+1,node.node.y),node,G+10);
						if(!closedList.isIn(botNode)){
							if(openList.isIn(botNode)){
								var testPos = openList.getNode(botNode);
								if(openList[testPos].G > botNode.G){
									openList[testPos].p = node;
								}
							}else{
								openList.push(botNode);
							}
						}
					}
				}
				if(node.node.y > 0){
					if(boardList[node.node.x][node.node.y-1]!=1){
						var lefNode = new Node(new point(node.node.x,node.node.y-1),node,G+10);
						if(!closedList.isIn(lefNode)){
							if(openList.isIn(lefNode)){
								var testPos = openList.getNode(lefNode);
								if(openList[testPos].G > lefNode.G){
									openList[testPos].p = node;
								}
							}else{
								openList.push(lefNode);
							}
						}
					}
				}
				if(node.node.y < 9){
					if(boardList[node.node.x][node.node.y+1]!=1){
						var rigNode = new Node(new point(node.node.x,node.node.y+1),node,G+10);
						if(!closedList.isIn(rigNode)){
							if(openList.isIn(rigNode)){
								var testPos = openList.getNode(rigNode);
								if(openList[testPos].G > rigNode.G){
									openList[testPos].p = node;
								}
							}else{
								openList.push(rigNode);
							}
						}
					}
				}
			}
			var node = openList[openList.getMin()];
			result.push(node);
			while(node.G){
				node = node.parentNode;
				result.push(node);
			}
			return result.reverse();
		}
		function Node (p,parent,G){
			this.node = p;
			this.parentNode = parent || null;
			this.H = Math.abs(p.x - end.x) + Math.abs(p.y - end.y);
			this.G = G;
			this.F = this.G + this.H;
		}
		function init () {
			for(var i = 0;i<rows;i++){
				boardList[i] = [];
				for(var j = 0;j<colums;j++){
					boardList[i][j] = Math.floor(Math.random()*10) > 0 ? 0:1;
				}
			}
		}
		init();
		for(var i = 0;i < boardList.length;i++){
			for(var j = 0;j < boardList[i].length;j++){
				var wall = document.createElement("span");
				if(start.isEqual(new point(i,j))){
					wall.style.backgroundColor = "green";
				}
				if(end.isEqual(new point(i,j))){
					wall.style.backgroundColor = "red";
				}
				if(boardList[i][j] == 1){
					wall.className = "wall";
				}
				board.appendChild(wall);
			}
		}
		btn.onclick = function(){
			var result = getPath(start,end);
			var nodes = board.getElementsByTagName("span");
			for(var i = 0;i < result.length;i++){
				var node = result[i].node;
				nodes[node.x*colums+node.y].style.backgroundColor = "#000000";
			}
		}
	</script>
</body>
</html>